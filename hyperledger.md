# hyperledger
* 基本的に、v1.4を使うべきだと思う。
* アプリケーションのイメージが違った。アプリケーションはあくまで、fabricを束ねるという意味でのアプリケーションっぽい
  - node.jsへのRESTでアクセス
  - golangで開発ができるが、公式ではないので、後回しかな

* chaincodeはgolangを使用


## 参考URL
[hyperledger note](https://note.com/masa_and_tomo/n/n0b82cef2b02b)

[概念がわかる](https://www.slideshare.net/oracle4engineer/ochacafe-4-hyperledger-fabric)

[基本これを参考に](https://hyperledger-fabric.readthedocs.io/en/release-1.4/prereqs.html)

[ibm](https://www.ibm.com/developerworks/jp/cloud/library/cl-hyperledger-fabric-basic-6/index.html)

[これもいい感じ](https://blockchain.cyberagent.studio/blog/290/)

[安心な感じ](https://qiita.com/kyrieleison/items/ec5223bbe6140822df4a)


[hyperledger note](https://note.com/masa_and_tomo/n/n0b82cef2b02b)


# パブリック型
* bitcoin
* etherium

# プライベート型
* iroha
* fabric

# コンソーシアム型
プライベート型の、さらに「コンソーシアム型」と呼ばれるブロックチェーンに分類されます。

- プライベート型
   - 単一の参加者（企業）だけが利用できる
- コンソーシアム型
   - 許可された複数の参加者でブロックチェーンを共有することが可能です。

# Hyperledger Fabric
Hyperledger Fabricは分散台帳としてのブロックチェーン単体の機能を提供しているのではなく
## 構成と役割
* Peer : 分散台帳を保持
   - Peerは内部に情報を記録するための台帳を保持しています。また、複数のPeerがチャネルと呼ばれるネットワークで連結され、ブロックチェーンを構成しています

* Orderer : Peerへ書き込む情報を送信
   - ブロックチェーンへの情報の書き込みは、アプリケーションがPeerに対して直接行うことはできません.   
   Ordererがブロックチェーンへ書き込む情報の順序づけを行い、チャネルを通じて全てのPeerへ書き込む情報を送信します


* CA : 台帳へのアクセスを管理
   - 証明書の発行を役割に持っており、Hyperledger Fabricにアクセスしてきたアプリケーションの認証を行い、ブロックチェーンにアクセスするために必要な証明書を発行します

３つの要素で、ブロックチェーンを利用するための機能全体を提供しています。

## トランザクションの流れ
1. 証明書の申請
   - アプリケーションはHyperledger Fabricのネットワークに参加するために、CAに証明書の発行申請をします。
   - CAはアプリケーションのID情報を確認し、証明書を発行します。

2. トランザクションの発行
   - アプリケーションはCAから証明書を受け取ると、トランザクションを発行し、証明書と一緒にPeerに送付します。
   - Peerはアプリケーションからトランザクションを受け取ると、そのトランザクションが不正な内容でないか、Endosement Policyと呼ばれるルールを基に検証を行います。
   - Peerは検証が済むと検証結果と署名をアプリケーションに送信します

- トランザクション
  - 「AさんからBさんへ○○コイン送金」といった様な、ブロックチェーンに書き込みたい情報
- Endosement Policy
  - https://gakumura.hatenablog.com/entry/2018/11/25/011810

3. トランザクションのブロードキャスト
   - アプリケーションはPeerから検証結果を受け取ると、Ordererへトランザクションを送付します。
   - Ordererはアプリケーションから送付されたトランザクションの順序付けを行い、複数のトランザクションを１つのブロックにパッケージして、Peerに送信します。
   - そしてPeerはOrdererから受け取ったブロックを検証し、台帳へ書き込みます。

- ブロードキャスト
  - OrdererからPeerへのブロック化されたトランザクションの送信


## peer
Peerの中には「台帳」と台帳にアクセスするための「チェーンコード」の二つが含まれています
### 台帳
* 台帳の中にはさらに「ステートDB」と「ブロックチェーン」が含まれています。

* チェーンコードの実行履歴がブロックチェーンに記録され、トランザクションを書き込んだ最新の台帳の情報がステートDBに記録されます

* 最新の情報を保持したステートDBにアクセスすることで、高速に処理を完了することができます。

### チェーンコード
* チェーンコードは台帳へのアクセスが唯一許可されたプログラムです。

* チェーンコードに特定の決められた処理だけを記述しておくことで、台帳への不正な処理を防げるようになっています。

* チェーンコードもPeerで同じものが保持されています。

## orderer
* クライアントから送信されたトランザクションの順序付けを行い、トランザクションをブロックにまとめます。

* そのブロックをブロックチェーンネットワーク内に、チャネルと呼ばれる仮想のネットワークを通じて配送します。

## CA
1. まず、ブロックチェーンネットワークの管理者がCAにユーザーの登録を行います。

2. CAは登録されたユーザーに紐づくSecret（パスワード）を管理者に返却します。

3. 管理者は、登録したユーザーにSecretを伝えます。

4. ユーザーはCAに自分自身のIDとSecretをCAに伝えます。

5. CAはユーザーのIDとSecretを照合し、ブロックチェーンにアクセスするための証明書（Ecerts）をユーザーに発行します。